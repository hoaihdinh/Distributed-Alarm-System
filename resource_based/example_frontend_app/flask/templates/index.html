<!DOCTYPE html>
<html>
<head>
  <title>Login</title>
  <style>
    body { font-family: Arial; background: #d6f6ff; padding: 2em; }
    h1 { color: #333; }
    form { margin-bottom: 1em; }
    input { padding: 0.4em; margin-right: 0.5em; }
    button { padding: 0.4em 0.8em; background: #0066cc; color: white; border: none; cursor: pointer; margin-right: 0.5em; }
    button:hover { background: #004c99; }
  </style>
</head>

<body>
  <h1>Distributed Alarm System</h1>
  <form id="loginForm">
    <input type="text" id="username" placeholder="Username" required>
    <input type="password" id="password" placeholder="Password" required>
    <button type="button" id="loginButton">Sign In</button>
    <button type="button" id="signupButton">Sign Up</button>
  </form>

  <div id="message" style="color:red; margin-top:1em;"></div>
</body>

<script>
  document.getElementById("signupButton").addEventListener("click", async () => {
    const username = document.getElementById("username").value;
    const password = document.getElementById("password").value;
    const messageDiv = document.getElementById("message");

    try {
      const response = await fetch("/users/register", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, password })
      });

      if (response.status === 201) {
        messageDiv.style.color = "green";
        messageDiv.textContent = "User created successfully! Redirecting...";
        setTimeout(() => { window.location.href = "/dashboard"; }, 500);
      } else if (response.status === 409) {
        messageDiv.style.color = "red";
        messageDiv.textContent = "User already exists!";
      } else {
        messageDiv.style.color = "red";
        messageDiv.textContent = "Something went wrong!";
      }
    } catch (err) {
      messageDiv.style.color = "red";
      messageDiv.textContent = "Network error!";
    }
  });
  document.getElementById("loginButton").addEventListener("click", async () => {
    const username = document.getElementById("username").value;
    const password = document.getElementById("password").value;
    const messageDiv = document.getElementById("message");

    try {
      const response = await fetch("/users/authenticate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, password })
      });

      if (response.status === 201) {
        messageDiv.style.color = "green";
        messageDiv.textContent = "User login successfully! Redirecting...";
        setTimeout(() => { window.location.href = "/dashboard"; }, 500);
      } else if (response.status === 401) {
        messageDiv.style.color = "red";
        messageDiv.textContent = "Invalid credentials!";
      } else {
        messageDiv.style.color = "red";
        messageDiv.textContent = "Something went wrong!";
      }
    } catch (err) {
      messageDiv.style.color = "red";
      messageDiv.textContent = "Network error!";
    }
  });
</script>
</html>
